(function() {
    'use strict';

    console.log('TamperMonkey script started');

    function setDirectNavigation() {
        console.log('Setting Direct Navigation state...');
        const directNavRadio = document.querySelector('#directSearchRadio');
        if (directNavRadio) {
            console.log('Direct Navigation radio input found:', directNavRadio);
            directNavRadio.checked = true;
            const changeEvent = new Event('change', { bubbles: true });
            directNavRadio.dispatchEvent(changeEvent);
            console.log('Direct Navigation state set');
        } else {
            console.error('Direct Navigation radio input not found');
        }
    }

    function performSearch() {
        console.log('Attempting to find the search input...');
        const searchInput = document.querySelector('#search-landing');
        if (searchInput) {
            console.log('Search input found:', searchInput);

            searchInput.focus();

            // Clear any existing value and set the new value
            searchInput.value = '';
            searchInput.dispatchEvent(new Event('input', { bubbles: true }));
            searchInput.value = 'SFARGFE';
            searchInput.dispatchEvent(new Event('input', { bubbles: true }));

            console.log('Entered text into search input');

            // Simulate pressing the Enter key
            const enterEvent = new KeyboardEvent('keydown', { key: 'Enter', bubbles: true });
            searchInput.dispatchEvent(enterEvent);
            searchInput.dispatchEvent(new KeyboardEvent('keypress', { key: 'Enter', bubbles: true }));
            searchInput.dispatchEvent(new KeyboardEvent('keyup', { key: 'Enter', bubbles: true }));

            console.log('Simulated Enter key press');

            // Wait for search results to load and click the result
            waitForElement('#SearchResult .searchItem[data-name="SFARGFE"]', (resultElement) => {
                console.log('Search result found:', resultElement);
                resultElement.click();
            });
        } else {
            console.error('Search input not found');
        }
    }

    function waitForElement(selector, callback) {
        console.log(`Waiting for element with selector: ${selector}`);
        const checkExist = setInterval(() => {
            const element = document.querySelector(selector);
            if (element) {
                console.log(`Element found: ${selector}`, element);
                clearInterval(checkExist);
                callback(element);
            } else {
                console.log(`Element not found yet: ${selector}`);
            }
        }, 100);

        const observer = new MutationObserver(() => {
            try {
                const element = document.querySelector(selector);
                if (element) {
                    console.log(`Element found by MutationObserver: ${selector}`, element);
                    observer.disconnect();
                    clearInterval(checkExist);
                    callback(element);
                }
            } catch (error) {
                console.error('Error querying selector:', selector, error);
            }
        });
        observer.observe(document.body, { childList: true, subtree: true });
    }

    setTimeout(() => {
        setDirectNavigation();
        setTimeout(() => {
            performSearch();
        }, 1000);
    }, 2000);

    console.log('Script execution delayed for 2 seconds');
})();
